worker_processes  auto;

# 파일 디스크립터 상한
worker_rlimit_nofile 1048576;

events {
    # 리눅스면 자동 감지되지만 명시적으로
    use epoll;
    worker_connections  65535;   # worker * connections ≈ 최대 동시 연결 수(이론치)
    multi_accept on;
    accept_mutex off;            # REUSEPORT 사용 시 보통 off
}

pid /var/run/nginx.pid;

error_log /var/log/nginx/error.log warn;

http {
    include       mime.types;
    default_type  text/plain;

    # 로그 I/O 오버헤드 최소화
    access_log off;
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;

    keepalive_timeout 15;
    keepalive_requests 100000;

    # 커넥션 재사용/포트 재사용 최적화
    open_file_cache off;

    # 리스닝 소켓 튜닝
    server {
        listen 80 reuseport backlog=65535;

        # 가장 가벼운 핸들러 — CPU/디스크 오버헤드 최소화
        location = / {
            return 200 "OK\n";
        }

        # 다수 경로 테스트용
        location /ping {
            return 200 "pong\n";
        }
    }
}

